# .bash_prompt

function timerStart {
    timerStart=${timerStart:-$(date +%s%N)}
}

function timerStop {
    local delta_us=$((($(date +%s%N) - $timerStart) / 1000))
    local us=$((delta_us % 1000))
    local ms=$(((delta_us / 1000) % 1000))
    local s=$(((delta_us / 1000000) % 60))
    local m=$(((delta_us / 60000000) % 60))
    local h=$((delta_us / 3600000000))
    if ((h > 0)); then
        timerString=${h}h${m}m
    elif ((m > 0)); then
        timerString=${m}m${s}s
    elif ((s >= 10)); then
        timerString=${s}.$((ms / 100))s
    elif ((s > 0)); then
        timerString=${s}.$(printf %03d $ms)s
    elif ((ms >= 100)); then
        timerString=${ms}ms
    elif ((ms > 0)); then
        timerString=${ms}.$((us / 100))ms
    else
        timerString=${us}us
    fi
    unset timerStart
}

trap '__=$_; timerStart; : "$__"' DEBUG
export PROMPT_COMMAND='timerStop; history -a'

BOLD="$(tput bold)"
WHITE="$(tput setaf 7)"
PINK="\e[38;5;198m"
RESET="$(tput sgr0)"

export PS1='\[${BOLD}\]'"\[${PINK}\]"'\W \[${WHITE}\](${timerString})\[${RESET}\] '
